[gd_scene load_steps=8 format=3 uid="uid://cgvqkt7i7jk1b"]

[ext_resource type="Script" path="res://CpuCalculation.gd" id="1"]
[ext_resource type="Script" path="res://ShaderCalculation.gd" id="2"]
[ext_resource type="Script" path="res://ShaderThreadCalculation.gd" id="3"]

[sub_resource type="Shader" id="1"]
code = "shader_type canvas_item;
render_mode unshaded;

void fragment() {
	vec2 pixel_min = vec2(0.0, TEXTURE_PIXEL_SIZE.y);
	vec2 pixel_max = vec2(TEXTURE_PIXEL_SIZE.x, TEXTURE_PIXEL_SIZE.y * 2.0);
	
	if (UV.x > pixel_min.x && UV.x < pixel_max.x && UV.y > pixel_min.y && UV.y < pixel_max.y) {
		//COLOR = vec4(vec3(1.0), 1.0);
		
		float total = 0.0;
		float complete = 0.0;
		
		for (float x = 0.0; x <= 1.0; x += TEXTURE_PIXEL_SIZE.x) {
			for (float y = 0.0; y <= 1.0; y += TEXTURE_PIXEL_SIZE.y) {
				vec4 color = textureLod(TEXTURE, vec2(x,y), 0.0);
				if (color.r > 0.0) {
					total += 1.0;
					if (color.r < 1.0)
						complete += 1.0;
				}
			}
		}
		float coverage = complete / total;
		COLOR = vec4(vec3(coverage, 0.0, 0.0), 1.0);
	}	else {
		COLOR = texture(TEXTURE, UV);
	}
}"

[sub_resource type="ShaderMaterial" id="2"]
shader = SubResource( "1" )

[sub_resource type="ViewportTexture" id="3"]
viewport_path = NodePath("CenterContainer/Layout/Map/Viewport")

[sub_resource type="ViewportTexture" id="4"]
viewport_path = NodePath("CenterContainer/Layout/ShaderThreadCalculation/ViewportContainer/Viewport")

[node name="Main" type="CanvasLayer"]
script = null

[node name="CenterContainer" type="CenterContainer" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
script = null
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Layout" type="HBoxContainer" parent="CenterContainer"]
offset_left = 262.0
offset_top = 210.0
offset_right = 761.0
offset_bottom = 390.0
theme_override_constants/separation = 32
script = null
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Map" type="SubViewportContainer" parent="CenterContainer/Layout"]
texture_filter = 1
offset_right = 100.0
offset_bottom = 180.0
rect_min_size = Vector2(100, 100)
script = null

[node name="Viewport" type="SubViewport" parent="CenterContainer/Layout/Map"]
handle_input_locally = false
size = Vector2i(100, 100)
render_target_update_mode = 4
script = null

[node name="Grass" type="ColorRect" parent="CenterContainer/Layout/Map/Viewport"]
rect_min_size = Vector2(100, 100)
script = null

[node name="House" type="ColorRect" parent="CenterContainer/Layout/Map/Viewport"]
offset_left = 10.0
offset_top = 10.0
offset_right = 50.0
offset_bottom = 40.0
color = Color(0, 0, 0, 1)
script = null

[node name="Mower" type="Line2D" parent="CenterContainer/Layout/Map/Viewport"]
points = PackedVector2Array(0, 100, 10, 90, 20, 85, 30, 80)
default_color = Color(0.298039, 0.298039, 0.298039, 1)
script = null

[node name="CpuCalculation" type="VBoxContainer" parent="CenterContainer/Layout"]
offset_left = 132.0
offset_right = 208.0
offset_bottom = 180.0
script = ExtResource( "1" )

[node name="Title" type="Label" parent="CenterContainer/Layout/CpuCalculation"]
offset_right = 76.0
offset_bottom = 26.0
text = "CPU Loop"
structured_text_bidi_override_options = []
script = null

[node name="CheckButton" type="CheckButton" parent="CenterContainer/Layout/CpuCalculation"]
offset_top = 30.0
offset_right = 76.0
offset_bottom = 70.0
script = null
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Coverage" type="Label" parent="CenterContainer/Layout/CpuCalculation"]
offset_top = 74.0
offset_right = 76.0
offset_bottom = 100.0
text = "78%"
structured_text_bidi_override_options = []
script = null

[node name="Time" type="Label" parent="CenterContainer/Layout/CpuCalculation"]
offset_top = 104.0
offset_right = 76.0
offset_bottom = 130.0
text = "23.304ms"
structured_text_bidi_override_options = []
script = null

[node name="DataSize" type="Label" parent="CenterContainer/Layout/CpuCalculation"]
offset_top = 134.0
offset_right = 76.0
offset_bottom = 160.0
text = "5x5"
structured_text_bidi_override_options = []
script = null

[node name="ShaderCalculation" type="VBoxContainer" parent="CenterContainer/Layout"]
offset_left = 240.0
offset_right = 337.0
offset_bottom = 180.0
script = ExtResource( "2" )

[node name="Title" type="Label" parent="CenterContainer/Layout/ShaderCalculation"]
offset_right = 97.0
offset_bottom = 26.0
text = "Shader Loop"
align = 1
structured_text_bidi_override_options = []
script = null

[node name="CheckButton" type="CheckButton" parent="CenterContainer/Layout/ShaderCalculation"]
offset_top = 30.0
offset_right = 97.0
offset_bottom = 70.0
script = null

[node name="Coverage" type="Label" parent="CenterContainer/Layout/ShaderCalculation"]
offset_top = 74.0
offset_right = 97.0
offset_bottom = 100.0
text = "78%"
structured_text_bidi_override_options = []
script = null

[node name="Time" type="Label" parent="CenterContainer/Layout/ShaderCalculation"]
offset_top = 104.0
offset_right = 97.0
offset_bottom = 130.0
text = "23.304ms"
structured_text_bidi_override_options = []
script = null

[node name="DataSize" type="Label" parent="CenterContainer/Layout/ShaderCalculation"]
offset_top = 134.0
offset_right = 97.0
offset_bottom = 160.0
text = "5x5"
structured_text_bidi_override_options = []
script = null

[node name="ViewportContainer" type="SubViewportContainer" parent="CenterContainer/Layout/ShaderCalculation"]
texture_filter = 1
offset_left = 47.0
offset_top = 164.0
offset_right = 49.0
offset_bottom = 166.0
size_flags_horizontal = 4
script = null
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Viewport" type="SubViewport" parent="CenterContainer/Layout/ShaderCalculation/ViewportContainer"]
disable_3d = true
handle_input_locally = false
size = Vector2i(2, 2)
render_target_update_mode = 4
script = null

[node name="TextureRect" type="TextureRect" parent="CenterContainer/Layout/ShaderCalculation/ViewportContainer/Viewport"]
texture_filter = 1
material = SubResource( "2" )
texture = SubResource( "3" )
script = null

[node name="TextureRect" type="TextureRect" parent="CenterContainer/Layout/ShaderCalculation"]
texture_filter = 1
offset_top = 170.0
offset_right = 97.0
offset_bottom = 180.0
rect_min_size = Vector2(10, 10)
texture = SubResource( "4" )
expand = true
stretch_mode = 6
script = null

[node name="ShaderThreadCalculation" type="VBoxContainer" parent="CenterContainer/Layout"]
offset_left = 369.0
offset_right = 499.0
offset_bottom = 180.0
script = ExtResource( "3" )

[node name="Title" type="Label" parent="CenterContainer/Layout/ShaderThreadCalculation"]
offset_right = 130.0
offset_bottom = 26.0
text = "Shader in Thread"
align = 1
structured_text_bidi_override_options = []
script = null

[node name="CheckButton" type="CheckButton" parent="CenterContainer/Layout/ShaderThreadCalculation"]
offset_top = 30.0
offset_right = 130.0
offset_bottom = 70.0
script = null

[node name="Coverage" type="Label" parent="CenterContainer/Layout/ShaderThreadCalculation"]
offset_top = 74.0
offset_right = 130.0
offset_bottom = 100.0
text = "78%"
structured_text_bidi_override_options = []
script = null

[node name="Time" type="Label" parent="CenterContainer/Layout/ShaderThreadCalculation"]
offset_top = 104.0
offset_right = 130.0
offset_bottom = 130.0
text = "23.304ms"
structured_text_bidi_override_options = []
script = null

[node name="DataSize" type="Label" parent="CenterContainer/Layout/ShaderThreadCalculation"]
offset_top = 134.0
offset_right = 130.0
offset_bottom = 160.0
text = "5x5"
structured_text_bidi_override_options = []
script = null

[node name="ViewportContainer" type="SubViewportContainer" parent="CenterContainer/Layout/ShaderThreadCalculation"]
texture_filter = 1
offset_left = 64.0
offset_top = 164.0
offset_right = 66.0
offset_bottom = 166.0
size_flags_horizontal = 4
script = null
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Viewport" type="SubViewport" parent="CenterContainer/Layout/ShaderThreadCalculation/ViewportContainer"]
disable_3d = true
handle_input_locally = false
size = Vector2i(2, 2)
render_target_update_mode = 4
script = null

[node name="TextureRect" type="TextureRect" parent="CenterContainer/Layout/ShaderThreadCalculation/ViewportContainer/Viewport"]
texture_filter = 1
material = SubResource( "2" )
texture = SubResource( "3" )
script = null

[node name="TextureRect" type="TextureRect" parent="CenterContainer/Layout/ShaderThreadCalculation"]
texture_filter = 1
offset_top = 170.0
offset_right = 130.0
offset_bottom = 180.0
rect_min_size = Vector2(10, 10)
texture = SubResource( "4" )
expand = true
stretch_mode = 6
script = null
